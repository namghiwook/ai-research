**주제: KOSIS 데이터를 활용한 가상 설문 대상(4,000만 명) 결합 확률 분포(IPF) 생성**

### 1. 배경 및 목적

대한민국 성인 인구 약 4,000만 명을 대표하는 가상 인구 프로필(Synthetic Population)을 생성하기 위해, 파편화된 KOSIS 통계 데이터들을 통합하여 **[지역 x 연령 x 성별 x 소득분위]**의 고차원 결합 확률 분포 테이블을 생성해야 합니다.

### 2. 데이터 수집 가이드 (KOSIS)

다음 항목들에 대해 최신 연도(2020년~2024년 사이) 데이터를 KOSIS 사이트에서 openapi 를 이용하여 조회하세요.
API_KEY 는 "ZDcwZjllMDU5NTYwOTlhMjkyYTRmNjFjZDhiMmFlMGY=" 를 사용하세요.

데이터 수집에 이용할 openapi url 목록은 다음과 같다.
    // 인구, 가구 및 주택 – 읍면동(연도 끝자리 0, 5), 시군구(그 외 연도)
    https://kosis.kr/openapi/Param/statisticsParameterData.do?method=getList&apiKey=ZDcwZjllMDU5NTYwOTlhMjkyYTRmNjFjZDhiMmFlMGY=&itmId=T100+T110+T120+T130+T131+T132+T140+T141+T142+T200+T210+T220+T230+T310+T311+T312+T313+T314+T315+T320+&objL1=00+04+05+03+11+11010+11020+11030+11040+11050+11060+11070+11080+11090+11100+11110+11120+11130+11140+11150+11160+11170+11180+11190+11200+11210+11220+11230+11240+11250+21+21004+21005+21003+21010+21020+21030+21040+21050+21060+21070+21080+21090+21100+21110+21120+21130+21140+21150+21510+22+22004+22005+22003+22010+22020+22030+22040+22050+22060+22070+22510+22520+23+23004+23005+23003+23010+23020+23030+23040+23050+23060+23070+23080+23090+23510+23520+24+24010+24020+24030+24040+24050+25+25010+25020+25030+25040+25050+26+26004+26005+26003+26010+26020+26030+26040+26510+29+29004+29005+29003+29010+31+31004+31005+31003+31010+31011+31012+31013+31014+31020+31021+31022+31023+31030+31040+31041+31042+31050+31051+31052+31053+31060+31070+31080+31090+31091+31092+31100+31101+31103+31104+31110+31120+31130+31140+31150+31160+31170+31180+31190+31191+31192+31193+31200+31210+31220+31230+31240+31250+31260+31270+31280+31550+31570+31580+32+32004+32005+32003+32010+32020+32030+32040+32050+32060+32070+32510+32520+32530+32540+32550+32560+32570+32580+32590+32600+32610+33+33004+33005+33003+33020+33030+33040+33041+33042+33043+33044+33520+33530+33540+33550+33560+33570+33580+33590+34+34004+34005+34003+34010+34011+34012+34020+34030+34040+34050+34060+34070+34080+34510+34530+34540+34550+34560+34570+34580+35+35004+35005+35003+35010+35011+35012+35020+35030+35040+35050+35060+35510+35520+35530+35540+35550+35560+35570+35580+36+36004+36005+36003+36010+36020+36030+36040+36060+36510+36520+36530+36550+36560+36570+36580+36590+36600+36610+36620+36630+36640+36650+36660+36670+36680+37+37004+37005+37003+37010+37011+37012+37020+37030+37040+37050+37060+37070+37080+37090+37100+37510+37520+37530+37540+37550+37560+37570+37580+37590+37600+37610+37620+37630+38+38004+38005+38003+38030+38050+38060+38070+38080+38090+38100+38110+38111+38112+38113+38114+38115+38510+38520+38530+38540+38550+38560+38570+38580+38590+38600+39+39004+39005+39003+39010+39020+&objL2=&objL3=&objL4=&objL5=&objL6=&objL7=&objL8=&format=json&jsonVD=Y&prdSe=Y&newEstPrdCnt=3&orgId=101&tblId=DT_1IN1502

    // 연령 및 성별 인구 – 읍면동
    https://kosis.kr/openapi/Param/statisticsParameterData.do?method=getList&apiKey=ZDcwZjllMDU5NTYwOTlhMjkyYTRmNjFjZDhiMmFlMGY=&itmId=T00+T01+T02+T03+T10+T11+T12+T13+&objL1=00+04+05+03+11+21+22+23+24+25+26+29+31+32+33+34+35+36+37+38+39+&objL2=000+005+010+015+020+025+030+035+040+045+050+055+060+065+070+075+080+085+090+095+100+101+102+103+104+086+126+127+&objL3=&objL4=&objL5=&objL6=&objL7=&objL8=&format=json&jsonVD=Y&prdSe=Y&newEstPrdCnt=3&orgId=101&tblId=DT_1IN1503

    // 성, 연령 및 혼인상태별 인구 - 시군구
    https://kosis.kr/openapi/Param/statisticsParameterData.do?method=getList&apiKey=ZDcwZjllMDU5NTYwOTlhMjkyYTRmNjFjZDhiMmFlMGY=&itmId=T1+T2+T3+T4+T5+T6+T7+T8+T9+T10+T11+T12+&objL1=00+03+04+05+11+21+22+23+24+25+26+29+31+32+33+34+35+36+37+38+39+&objL2=ALL&objL3=&objL4=&objL5=&objL6=&objL7=&objL8=&format=json&jsonVD=Y&prdSe=Y&newEstPrdCnt=3&orgId=101&tblId=DT_1MR2060

    // 성, 연령 및 교육정도, 교육상태별 인구(6세이상, 내국인)-시군구
    https://kosis.kr/openapi/Param/statisticsParameterData.do?method=getList&apiKey=ZDcwZjllMDU5NTYwOTlhMjkyYTRmNjFjZDhiMmFlMGY=&itmId=T10+T20+T21+T22+T23+T30+T31+T32+T33+T40+T41+T42+T43+T50+T51+T52+T53+T54+T55+T60+T61+T62+T63+T64+T65+T70+T71+T72+T73+T74+T80+T81+T82+T83+T84+T90+&objL1=00+03+04+05+11+21+22+23+24+25+26+29+31+32+33+34+35+36+37+38+39+&objL2=0+&objL3=000+&objL4=&objL5=&objL6=&objL7=&objL8=&format=json&jsonVD=Y&prdSe=F&newEstPrdCnt=3&orgId=101&tblId=DT_1PM2001

    // 성, 연령, 혼인상태 및 교육정도별 인구(15세 이상, 내국인)-시군구
    https://kosis.kr/openapi/Param/statisticsParameterData.do?method=getList&apiKey=ZDcwZjllMDU5NTYwOTlhMjkyYTRmNjFjZDhiMmFlMGY=&itmId=T10+T20+T21+T22+T23+T30+T31+T32+T33+T40+T41+T42+T43+T50+T51+T52+T53+T54+T55+T60+T61+T62+T63+T64+T65+T70+T71+T72+T73+T74+T80+T81+T82+T83+T84+T90+&objL1=&objL2=00+&objL3=ALL&objL4=ALL&objL5=ALL&objL6=&objL7=&objL8=&format=json&jsonVD=Y&prdSe=F&newEstPrdCnt=3&orgId=101&tblId=DT_1PM2003

    // 연령별/성별/혼인상태별 인구(15세이상,내국인)-시군구
    https://kosis.kr/openapi/Param/statisticsParameterData.do?method=getList&apiKey=ZDcwZjllMDU5NTYwOTlhMjkyYTRmNjFjZDhiMmFlMGY=&itmId=T10+T11+T12+T13+T14+T20+T21+T22+T23+T24+T30+T31+T32+T33+T34+&objL1=00+03+04+05+11+21+22+23+24+25+26+29+31+32+33+34+35+36+37+38+39+&objL2=000+020+025+030+035+040+045+050+055+060+065+070+075+080+085+086+&objL3=&objL4=&objL5=&objL6=&objL7=&objL8=&format=json&jsonVD=Y&prdSe=F&newEstPrdCnt=3&orgId=101&tblId=DT_1PM2002

    // 성별/연령별/혼인상태별 인구(15세이상, 내국인)-동읍면
    https://kosis.kr/openapi/Param/statisticsParameterData.do?method=getList&apiKey=ZDcwZjllMDU5NTYwOTlhMjkyYTRmNjFjZDhiMmFlMGY=&itmId=T1+&objL1=00+03+04+05+11+21+22+23+24+25+26+29+31+32+33+34+35+36+37+38+39+&objL2=ALL&objL3=ALL&objL4=ALL&objL5=&objL6=&objL7=&objL8=&format=json&jsonVD=Y&prdSe=F&newEstPrdCnt=3&orgId=101&tblId=DT_1PM2007

이 외 아래 내용 "1. 경제 및 고용 관련 항목 (Socio-Economic), 2. 주거 및 가구 환경 관련 항목 (Housing & Household)" 에 대한 openapi url 은 KOSIS 통계 목록을 조회해서 최선의 조회 항목을 찾아서 위 API_KEY 와 조합하여 만들어 데이터 조회를 추가로 한다.

1. 경제 및 고용 관련 항목 (Socio-Economic)
소득분위와 결합했을 때 소비 성향과 가치관을 가장 잘 설명해주는 변수들입니다.

산업 및 직업 대분류 (DT_1DA7001 등): 어떤 직종(사무직, 전문직, 서비스직, 제조직 등)에 종사하느냐에 따라 정치적 성향이나 라이프스타일 응답이 크게 달라집니다.

종사상 지위: 상용근로자, 임시근로자, 자영업자(고용원 유/무), 무급가족종사자 구분입니다. 특히 '자영업자' 페르소나는 정책 관련 설문에 독특한 응답 패턴을 보입니다.

교육정도 (학력): 중졸/고졸/대졸/대학원졸 등의 학력 수준은 정보 습득 경로와 가치관 형성에 큰 영향을 미칩니다.

2. 주거 및 가구 환경 관련 항목 (Housing & Household)
주거 상태는 미래에 대한 불안감이나 자산 형성 태도를 결정짓는 핵심 요소입니다.

점유형태 (자가, 전세, 월세): 주택 소유 여부는 경제적 만족도 및 부동산 정책 관련 응답에 결정적인 영향을 미칩니다.

거주주택 종류: 아파트, 단독주택, 연립/다세대, 오피스텔 등 거주 형태에 따라 소비 패턴과 이웃 관계망이 다르게 설정됩니다.

가구원수 및 세대구성: 1인 가구(자취생/독거노인), 부부+자녀 가구, 3세대 가구 등 가구 구성에 따라 설문 내 '가족 부양'이나 '개인주의' 성향이 달라집니다.


### 3. 기술적 요구 사항 (IPF 구현)

* **라이브러리:** `pandas`, `numpy`, `ipfn` (또는 직접 구현한 IPF 로직)을 사용하세요.
* **Base Table 구축:**
1. 지역, 연령, 성별, 소득분위를 포함해 추출할 수 있는 모든 고유 값을 추출하여 **Cartesian Product**를 생성합니다.
    a. 연령 - Age_Group : 다음 항목에 대한 데이터만 이용해줘.
        15-19
        20-24
        25-29
        30-34
        35-39
        40-44
        45-49
        50-54
        55-59
        60-64
        65-69
        70-74
        75-79
        80-84
        85-89
        90-94
        95-99
        100+
    b. 지역 - Sigungu : 제외
    c. 지역 - Sido : 
        '강원도'와 '강원특별자치도'는 같은 지역이니까 '강원도'로 합쳐줘.
        "전라북도"와 "전북특별자치도"는 같은 지역이니까 "전라북도'로 합쳐줘.
        "제주도"와 "제주특별자치도"는 같은 지역이니까 "제주도"로 합쳐줘.
        "세종시"와 "세종특별자치시"는 같은 지역이니까 "세종시"로 합쳐줘.
        "기타" 지역은 제외해줘.
        그러면 결과적으로 아래 지역 목록으로 정리될거야.
            강원도
            경기도
            경상남도
            경상북도
            광주광역시
            대구광역시
            대전광역시
            부산광역시
            서울특별시
            세종시
            울산광역시
            인천광역시
            전라남도
            전라북도
            제주도
            충청남도
            충청북도
    d. 소득분위 : 가능하다면 10분위 데이터를 우선 조회하고, 데이터가 파편화되어 부족하다면 5분위로 조정해.

2. **유효성 검사:** KOSIS 지역 통계를 기준으로 실제 존재하지 않는 '시도-시군구' 조합의 행(Row)은 반드시 제거하여 그리드를 최적화하세요.
3. `total` 컬럼을 만들어 균일한 초기 가중치를 할당하세요.


* **Aggregates(제약 조건) 처리:**
1. 수집된 각 통계표를 Long Format으로 변환하세요.
2. 모든 제약 조건 값은 전체 합계가 **1.0**이 되도록 **정규화(Normalization)**해야 합니다.

**단계별 확인:** 
먼저 데이터 수집 결과부터 확인시켜주고, 그 다음 IPF 로직을 작성해줘

**데이터 클리닝:** 
KOSIS 데이터에 '계', '소계'와 같은 합계 행이 포함되어 있습니다. 이를 제거하는 로직을 반드시 포함하세요.
행정구역 구분에서 '전국', '동부','읍부','면부'는 제외해주세요.  

* **알고리즘 실행:** `ipfn` 클래스를 사용하여 모든 제약 조건을 만족할 때까지 반복 계산을 수행하세요.

### 4. 최종 출력 및 저장

* **결과 형식:** Pandas DataFrame
* **컬럼 구성:** `Sido`, `Sigungu`, `Age_Group`, `Gender`, `Income_Quintile`, `Weight`
* **검증:** 최종 `Weight` 컬럼의 합계가 **1.0000**인지 확인하는 로그를 출력하세요.
* **파일 저장:** 생성된 최종 테이블을 `final_joint_distribution.csv` 또는 `pickle` 파일로 저장하세요.



